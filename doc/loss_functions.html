<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Erik-Jan van Kesteren" />


<title>Custom loss functions for SEM</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Custom loss functions for SEM</h1>
<h4 class="author">Erik-Jan van Kesteren</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tensorsem)</span></code></pre></div>
<pre><code>#&gt; Loading required package: torch</code></pre>
<pre><code>#&gt; Loading required package: lavaan</code></pre>
<pre><code>#&gt; This is lavaan 0.6-12
#&gt; lavaan is FREE software! Please report any bugs.</code></pre>
<p>With <code>tensorsem</code> we can estimate structural equation
models using maximum likelihood (ML), but we can also go beyond standard
multivariate normal ML to estimate the parameters. For example, we can
create a robust form of SEM by using a multivariate t-distribution
instead of a multivariate normal distribution for the observations. We
can also perform unweighted least squares, or weighted least squares.
Lastly, we can put custom penalties on any parameter in the model.</p>
<p>The machinery that enables all these custom objective functions is
automatic differentiation (through <code>torch</code>) and adaptive
gradient-based optimization algorithms, such as <code>optim_adam</code>.
In this vignette, we show how to do this.</p>
<div id="maximum-likelihood-estimation" class="section level2">
<h2>Maximum likelihood estimation</h2>
<p>Maximum likelihood estimation is the default in <code>lavaan</code>,
so that’s what we’ll compare to.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create model syntax</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>syntax <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="st">  # three-factor model</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="st">  visual  =~ x1 + x2 + x3</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="st">  textual =~ x4 + x5 + x6</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="st">  speed   =~ x7 + x8 + x9</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit lavaan model</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>fit_lavaan <span class="ot">&lt;-</span> <span class="fu">sem</span>(</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> syntax,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> HolzingerSwineford1939,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">std.lv =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">information =</span> <span class="st">&quot;observed&quot;</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed.x =</span> <span class="cn">FALSE</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>pt_lavaan <span class="ot">&lt;-</span> <span class="fu">partable</span>(fit_lavaan)</span></code></pre></div>
<p>And, in order to visually compare the different estimation methods,
we create a custom plot function:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>param_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  ptli <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  ptli <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(ptli), <span class="cf">function</span>(n) {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> ptli[[n]]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    out<span class="sc">$</span>method <span class="ot">&lt;-</span> n</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(out)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Reduce</span>(rbind, ptli) <span class="sc">|&gt;</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> id, <span class="at">y =</span> est, <span class="at">colour =</span> method,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">ymin =</span> est <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>se, <span class="at">ymax =</span> est <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>se)) <span class="sc">+</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_pointrange</span>(<span class="at">position =</span> ggplot2<span class="sc">::</span><span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Parameter&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Value&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;Method&quot;</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="fu">param_plot</span>(<span class="at">lavaan =</span> pt_lavaan)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="7" height="4" /></p>
<p>Now, we will estimate this same model using
<code>tensorsem</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the SEM model object</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>mod_ml <span class="ot">&lt;-</span> <span class="fu">torch_sem</span>(syntax, <span class="at">dtype =</span> <span class="fu">torch_float64</span>())</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create a data object as a torch tensor</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>dat_torch <span class="ot">&lt;-</span> <span class="fu">torch_tensor</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">scale</span>(HolzingerSwineford1939[,<span class="dv">7</span><span class="sc">:</span><span class="dv">15</span>], <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">requires_grad =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">dtype =</span> <span class="fu">torch_float64</span>(),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the model using default settings</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>mod_ml<span class="sc">$</span><span class="fu">fit</span>(<span class="at">dat =</span> dat_torch, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>#&gt; Fitting SEM with Adam optimizer and MVN log-likelihood loss</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-compute the log-likelihood &amp; create partable</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ll <span class="ot">&lt;-</span> mod_ml<span class="sc">$</span><span class="fu">loglik</span>(dat_torch)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>pt_ml <span class="ot">&lt;-</span> mod_ml<span class="sc">$</span><span class="fu">partable</span>(<span class="sc">-</span>ll)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compare to lavaan</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">param_plot</span>(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lavaan =</span> pt_lavaan,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">torch_ml =</span> pt_ml</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="7" height="4" /></p>
<p>As we can see, the two methods yield practically the same parameter
estimates and standard errors.</p>
</div>
<div id="robust-t-distributed-sem" class="section level1">
<h1>Robust t-distributed SEM</h1>
<p>Next, we’ll change the loss function to the negative log-likelihood
of a multivariate t-distribution with 2 degrees of freedom for each
variable.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a multivariate t log-likelihood distribution using torch operations</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for reference, see here: https://docs.pyro.ai/en/stable/_modules/pyro/distributions/multivariate_studentt.html</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># note that that code is APACHE-2.0 licensed</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>mvt_loglik <span class="ot">&lt;-</span> <span class="cf">function</span>(x, Sigma, <span class="at">nu =</span> <span class="dv">2</span>) {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> x<span class="sc">$</span>shape[<span class="dv">2</span>]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> x<span class="sc">$</span>shape[<span class="dv">1</span>]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  Schol <span class="ot">&lt;-</span> <span class="fu">linalg_cholesky</span>(Sigma)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># constant term</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  C <span class="ot">&lt;-</span> Schol<span class="sc">$</span><span class="fu">diag</span>()<span class="sc">$</span><span class="fu">log</span>()<span class="sc">$</span><span class="fu">sum</span>() <span class="sc">+</span>  p<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span><span class="fu">torch_log</span>(nu) <span class="sc">+</span> p<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(pi) <span class="sc">+</span> <span class="fu">torch_lgamma</span>(nu <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> <span class="fu">torch_lgamma</span>((p <span class="sc">+</span> nu) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># data-dependent term</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x<span class="sc">$</span><span class="fu">t</span>()<span class="sc">$</span><span class="fu">triangular_solve</span>(Schol, <span class="at">upper =</span> <span class="cn">FALSE</span>)[[<span class="dv">1</span>]]</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  D <span class="ot">&lt;-</span> <span class="fu">torch_log1p</span>(y<span class="sc">$</span><span class="fu">square</span>()<span class="sc">$</span><span class="fu">sum</span>(<span class="dv">1</span>) <span class="sc">/</span> nu)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> (nu <span class="sc">+</span> p) <span class="sc">*</span> D <span class="sc">-</span> C)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now, we will use this distribution as the loss function.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the SEM model object</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>mod_t <span class="ot">&lt;-</span> <span class="fu">torch_sem</span>(syntax, <span class="at">dtype =</span> <span class="fu">torch_float64</span>())</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize at the ml estimates for faster convergence</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>mod_t<span class="sc">$</span>dlt_vec <span class="ot">&lt;-</span> <span class="fu">as_array</span>(mod_ml<span class="sc">$</span>dlt_vec)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the optimizer</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>opt <span class="ot">&lt;-</span> <span class="fu">optim_adam</span>(mod_t<span class="sc">$</span>parameters, <span class="at">lr =</span> <span class="fl">0.01</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># start the training loop</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>iters <span class="ot">&lt;-</span> 200L</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>loglik <span class="ot">&lt;-</span> <span class="fu">numeric</span>(iters)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iters) {</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  opt<span class="sc">$</span><span class="fu">zero_grad</span>()</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <span class="fu">mod_t</span>()</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  loss <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">mvt_loglik</span>(dat_torch, Sigma)<span class="sc">$</span><span class="fu">sum</span>()</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  loglik[i] <span class="ot">&lt;-</span> <span class="sc">-</span>loss<span class="sc">$</span><span class="fu">item</span>()</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  loss<span class="sc">$</span><span class="fu">backward</span>()</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  opt<span class="sc">$</span><span class="fu">step</span>()</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Then, we can plot the optimization trajectory to see whether it’s
converged:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>opt_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(losses) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(losses), <span class="at">y =</span> losses), ggplot2<span class="sc">::</span><span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_plot</span>(loglik) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Epochs&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Log-Likelihood&quot;</span>, <span class="at">title =</span> <span class="st">&quot;ML estimation of multivariate T SEM&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="7" height="4" /></p>
<p>Then, we can again compare the parameter estimates:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-compute the log-likelihood &amp; create partable</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ll <span class="ot">&lt;-</span> <span class="fu">mvt_loglik</span>(dat_torch, <span class="fu">mod_t</span>())<span class="sc">$</span><span class="fu">sum</span>()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>pt_t <span class="ot">&lt;-</span> mod_t<span class="sc">$</span><span class="fu">partable</span>(<span class="sc">-</span>ll)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compare to lavaan</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">param_plot</span>(<span class="at">mvn =</span> pt_ml, <span class="at">t =</span> pt_t)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="7" height="4" /></p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
